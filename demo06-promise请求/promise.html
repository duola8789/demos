<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Promise</title>
</head>
<body>
</body>
<script>
  'use strict';
  function ajaxSucceed(value) {
    document.write(value)
  }
  function ajaxFail(value) {
    throw new Error(value);
  }
  //  原生ajax请求
  //  let xhr = new XMLHttpRequest();
  //  xhr.open('GET', 'test.txt');
  //  xhr.send(null);
  //  xhr.onreadystatechange = function () {
  //    if (xhr.readyState !== 4) {
  //      return;
  //    }
  //    if (xhr.status === 200) {
  //      ajaxSucceed(xhr.responseText)
  //    }
  //    else {
  //      ajaxFail(xhr.responseText)
  //    }
  //  };
  //  将原生ajax请求改造为promise形式
  let promise = new Promise(function (resolve, rejected) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', 'test.txt');
    xhr.send(null);
    xhr.onreadystatechange = function () {
      if (xhr.readyState !== 4) {
        return;
      }
      if (xhr.status === 200) {
        resolve(xhr.responseText)
      }
      else {
        rejected(xhr.responseText)
      }
    };
  });
  promise.then(function (value) {
    ajaxSucceed(value)
  }).catch(function (value) {
    ajaxFail(value)
  })
</script>
</html>
